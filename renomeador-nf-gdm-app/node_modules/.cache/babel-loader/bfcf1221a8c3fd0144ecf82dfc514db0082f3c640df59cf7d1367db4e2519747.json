{"ast":null,"code":"import React,{useState,useCallback,useEffect}from'react';import{useDropzone}from'react-dropzone';import axios from'axios';import'./App.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function App(){const API_URL=process.env.REACT_APP_API_URL||'http://localhost:5000';const[processedFiles,setProcessedFiles]=useState([]);const[message,setMessage]=useState('');const[loading,setLoading]=useState(false);const[savedFiles,setSavedFiles]=useState([]);const[showDetails,setShowDetails]=useState({});const loadSavedFiles=useCallback(async()=>{try{const response=await axios.get(`${API_URL}/files`);setSavedFiles(response.data);}catch(error){console.error('Erro ao carregar arquivos:',error);}},[API_URL]);// Adicionar API_URL como dependência\nuseEffect(()=>{loadSavedFiles();},[loadSavedFiles]);const onDrop=useCallback(async acceptedFiles=>{setLoading(true);setMessage('Processando arquivos...');const formData=new FormData();acceptedFiles.forEach(file=>{formData.append('pdfs',file);});try{// Remover a definição local de API_URL, pois agora está no escopo global\n// const API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000';\n// Fazer upload dos arquivos\nconst response=await axios.post(`${API_URL}/upload`,formData,{headers:{'Content-Type':'multipart/form-data'}});setProcessedFiles(response.data.files);setMessage(response.data.message);// Recarregar lista de arquivos salvos\nawait loadSavedFiles();}catch(error){console.error('Erro ao fazer upload:',error);setMessage('Erro ao processar os arquivos.');}finally{setLoading(false);}},[API_URL,loadSavedFiles]);// Adicionar API_URL e loadSavedFiles como dependências\nconst{getRootProps,getInputProps,isDragActive}=useDropzone({onDrop,accept:{'application/pdf':['.pdf']}});const clearAllFiles=async()=>{try{await axios.delete(`${API_URL}/files`);setSavedFiles([]);setProcessedFiles([]);setMessage('Todos os arquivos foram removidos');}catch(error){console.error('Erro ao limpar arquivos:',error);setMessage('Erro ao limpar arquivos');}};const toggleDetails=index=>{setShowDetails(prev=>({...prev,[index]:!prev[index]}));};const formatFileSize=bytes=>{if(bytes===0)return'0 Bytes';const k=1024;const sizes=['Bytes','KB','MB','GB'];const i=Math.floor(Math.log(bytes)/Math.log(k));return parseFloat((bytes/Math.pow(k,i)).toFixed(2))+' '+sizes[i];};return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsxs(\"header\",{className:\"App-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83D\\uDD04 Renomeador de Devolu\\xE7\\xF5es - GDM\"}),/*#__PURE__*/_jsx(\"p\",{className:\"subtitle\",children:\"Processe e renomeie suas notas fiscais automaticamente\"}),/*#__PURE__*/_jsxs(\"div\",{...getRootProps(),className:`dropzone ${isDragActive?'active':''}`,children:[/*#__PURE__*/_jsx(\"input\",{...getInputProps()}),/*#__PURE__*/_jsxs(\"div\",{className:\"dropzone-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"upload-icon\",children:\"\\uD83D\\uDCC4\"}),isDragActive?/*#__PURE__*/_jsx(\"p\",{children:\"Solte os arquivos PDF aqui...\"}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{children:\"Arraste e solte arquivos PDF aqui\"}),/*#__PURE__*/_jsx(\"p\",{className:\"or-text\",children:\"ou clique para selecionar\"})]})]})]}),loading&&/*#__PURE__*/_jsxs(\"div\",{className:\"loading\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Processando arquivos...\"})]}),message&&/*#__PURE__*/_jsx(\"div\",{className:`message ${message.includes('Erro')?'error':'success'}`,children:message}),processedFiles.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"results-section\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDCCB Resultados do Processamento\"}),/*#__PURE__*/_jsx(\"div\",{className:\"files-list\",children:processedFiles.map((file,index)=>/*#__PURE__*/_jsxs(\"div\",{className:`file-item ${file.status.toLowerCase()}`,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"file-header\",onClick:()=>toggleDetails(index),children:[/*#__PURE__*/_jsx(\"span\",{className:\"file-name\",children:file.originalName}),/*#__PURE__*/_jsxs(\"span\",{className:`status ${file.status.toLowerCase()}`,children:[file.status==='Processado'?'✅':file.status==='Ignorado'?'⚠️':'❌',\" \",file.status]}),/*#__PURE__*/_jsx(\"span\",{className:\"toggle-icon\",children:showDetails[index]?'▼':'▶'})]}),showDetails[index]&&/*#__PURE__*/_jsx(\"div\",{className:\"file-details\",children:file.status==='Processado'?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Novo nome:\"}),\" \",file.novoNome]}),file.extractedData&&/*#__PURE__*/_jsxs(\"div\",{className:\"extracted-data\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Dados Extra\\xEDdos:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"data-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"N\\xBA NF:\"}),\" \",file.extractedData.numeroNF]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"CNPJ:\"}),\" \",file.extractedData.cnpjEmitente]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Data:\"}),\" \",file.extractedData.dataEmissao]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Valor:\"}),\" R$ \",file.extractedData.valorTotal]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"CFOP:\"}),\" \",file.extractedData.cfop]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Natureza:\"}),\" \",file.extractedData.naturezaOperacao]})]}),file.extractedData.numeroAdicional&&/*#__PURE__*/_jsxs(\"div\",{className:\"additional-data\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Dados Adicionais:\"}),\" N\\xFAmero: \",file.extractedData.numeroAdicional,\", Motivo: \",file.extractedData.motivoAdicional]})]}),file.downloadPath&&/*#__PURE__*/_jsx(\"a\",{href:`${API_URL}${file.downloadPath}`,target:\"_blank\",rel:\"noopener noreferrer\",className:\"download-btn\",children:\"\\uD83D\\uDCE5 Download\"})]}):/*#__PURE__*/_jsx(\"p\",{className:\"reason\",children:file.reason})})]},index))})]}),savedFiles.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"saved-files-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\uD83D\\uDCBE Arquivos Salvos (\",savedFiles.length,\")\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:clearAllFiles,className:\"clear-btn\",children:\"\\uD83D\\uDDD1\\uFE0F Limpar Todos\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"saved-files-list\",children:savedFiles.map((file,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"saved-file-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"file-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"file-name\",children:file.name}),/*#__PURE__*/_jsx(\"span\",{className:\"file-size\",children:formatFileSize(file.size)})]}),/*#__PURE__*/_jsx(\"a\",{href:`${API_URL}${file.path}`,target:\"_blank\",rel:\"noopener noreferrer\",className:\"download-btn small\",children:\"\\uD83D\\uDCE5\"})]},index))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"instructions\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCD6 Como usar:\"}),/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{children:\"Arraste e solte arquivos PDF de notas fiscais na \\xE1rea acima\"}),/*#__PURE__*/_jsx(\"li\",{children:\"O sistema extrair\\xE1 automaticamente os dados e renomear\\xE1 os arquivos\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Arquivos com CFOP 2411, 6202, 5202 ou natureza \\\"DEV\\\" ser\\xE3o processados\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Os arquivos renomeados ficar\\xE3o dispon\\xEDveis para download\"})]})]})]})});}export default App;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}